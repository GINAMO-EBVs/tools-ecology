<tool id="vcf_subset" name="Subsetting SNPs at random from a VCF file" version="0.1.0">
    <description>
        given a chosen number of SNPs to use.
    </description>
        
    <requirements>
        <requirement type="package" version="1.22">bcftools</requirement>
        <requirement type="package" version="0.1.17">vcftools</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        mkdir -p vcf_subsampled &&

        bash '$__tool_directory__/VCF_subsampled.sh'
            '${vcf_input}'
            '${vcf_input.element_identifier}'
            '$SUBSET_SNPS_NB'
            '$NB_REPLICATE_VCF'
            '$MIN_SNP_NB'
        
        ]]></command>

    <inputs>
        <param name="vcf_input" type="data" format="vcf" label="Upload your VCF file"
            help="File containing SNP data in VCF format. You can upload a simple file, multiple file or a dataset collection"/>
        <param name="SUBSET_SNPS_NB" type="integer" value="1000" min="0" label="Number of SNPs chosen for a number of replicate VCF files per input VCF file" 
            />
        <param name="NB_REPLICATE_VCF" type="integer" value="5" min="1" label="Number of replicate VCF files"
            help="Number of replicate VCF files to create, each with a chosen subset of SNP."/>
        <param name="MIN_SNP_NB" type="integer" value="4000" min="0" label="Minimum number of SNPs above which SNP subsetting is performed"
            help="To perform SNP subsampling without applying a threshold, enter 0."/>
    </inputs>

    <outputs>
        <collection name="vcf_subsampled" format="vcf" type="list" label="${tool.name}">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.vcf$" directory="vcf_subsampled" format="vcf"/>
        </collection>
    </outputs>

    <tests>
        <test>
            <param name="vcf_input" value="test_vcf.vcf"/>
            <param name="SUBSET_SNPS_NB" value="1000"/>
            <param name="NB_REPLICATE_VCF" value="5"/>
            <param name="MIN_SNP_NB" value="4000"/>
            <output_collection name="vcf_subsampled" type="list" count="5"/>
        </test>
    </tests>

    <help><![CDATA[
Usage
=====

As input, the user provides one or more VCF files (Danecek *et al.* 2011), the desired number of SNPs to subsample per replicate VCF file, the number of replicate VCF files to generate, and a minimum SNP number threshold that needs to be present in the input file for the subsampling to occur.

For each input VCF file, if its SNP number exceeds the MIN_SNP_NB threshold, the tool generates the NB_REPLICATE_VCF that is requested. For each replicate VCF file,  the chosen SNP number (SUBSET_SNP_NB) are randomly selected from the total. if the SNP number in the file is below MIN_SNP_NB, the original input VCF file(s) is(are) kept unchanged in a separate output collection for subsequent analyses. To disable the threshold and force subsampling regardless of file size, set the minimum to 0. --> pas besoin?.

Example : If the user requests 5 replicate VCF files with 1 000 SNPs with a minimum threshold of 4 000, a VCF containing 10000 variants will produce 5 distinct subsets of 1 000 SNPs each, while a VCF with only 3 000 variants the input VCF is preserved.

Tips
====
According to Waples *et al. 2024*, using 1000 SNPs provide sufficient information for NeLD estimates, with little gain from additional loci.

See also examples of VCF formats in :  https://samtools.github.io/hts-specs/VCFv4.5.pdf

    ]]></help>

    <citations>
        <citation type="bibtex">
        @article{10.1093/gigascience/giab008,
    author = {Danecek, Petr and Bonfield, James K and Liddle, Jennifer and Marshall, John and Ohan, Valeriu and Pollard, Martin O and Whitwham, Andrew and Keane, Thomas and McCarthy, Shane A and Davies, Robert M and Li, Heng},
    title = "{Twelve years of SAMtools and BCFtools}",
    journal = {GigaScience},
    volume = {10},
    number = {2},
    year = {2021},
    abstract = "{SAMtools and BCFtools are widely used programs for processing and analysing high-throughput sequencing data. They include tools for file format conversion and manipulation, sorting, querying, statistics, variant calling, and effect analysis amongst other methods.The first version appeared online 12 years ago and has been maintained and further developed ever since, with many new features and improvements added over the years. The SAMtools and BCFtools packages represent a unique collection of tools that have been used in numerous other software projects and countless genomic pipelines.Both SAMtools and BCFtools are freely available on GitHub under the permissive MIT licence, free for both non-commercial and commercial use. Both packages have been installed \\&gt;1 million times via Bioconda. The source code and documentation are available from https://www.htslib.org.}",
    issn = {2047-217X},
    doi = {10.1093/gigascience/giab008},
    url = {https://doi.org/10.1093/gigascience/giab008},
    note = {giab008},
    eprint = {https://academic.oup.com/gigascience/article-pdf/10/2/giab008/36332246/giab008.pdf},
        }
        </citation>

        <citation type="bibtex">
            @article{Danecek2011,
  author          = {Danecek, Petr and Auton, Adam and Abecasis, Goncalo and Albers, Cornelis A. and Banks, Erica and DePristo, Mark A. and Handsaker, Robert E. and Lunter, Gerton and Marth, Gabor T. and Sherry, Stephen T. and McVean, Gil and Durbin, Richard and {1000 Genomes Project Analysis Group}},
  title           = {The variant call format and {VCF}tools},
  journal         = {Bioinformatics},
  volume          = {27},
  number          = {15},
  pages           = {2156-2158},
  year            = {2011},
  doi             = {10.1093/bioinformatics/btr330},
  URL             = {https://doi.org/10.1093/bioinformatics/btr330},
  eprint          = {https://academic.oup.com/bioinformatics/article-pdf/27/15/2156/600788/btr330.pdf},
}
        </citation>
    <citation type="bibtex">
        @manual{VCFv45,
  title        = {The Variant Call Format (VCF) Specification, Version 4.5},
  author       = {{HTS-specs team}},
  organization = {Global Alliance for Genomics and Health},
  year         = {2024},
  url          = {https://samtools.github.io/hts-specs/VCFv4.5.pdf},
  note         = {Accessed: 2025-02-11}
}
    </citation>

        <citation type="bibtex">
            @article{Waples2024_linkageLD,
    author    = {Waples, Robin S.},
    title     = {Practical application of the linkage disequilibrium method for estimating contemporary effective population size: A review},
    journal   = {Molecular Ecology Resources},
    volume    = {24},
    number    = {1},
    pages     = {e13879},
    year      = {2024},
    doi       = {10.1111/1755-0998.13879},
    }

        </citation>
    </citations>
</tool>
