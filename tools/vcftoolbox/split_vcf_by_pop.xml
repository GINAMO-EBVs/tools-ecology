<tool id="split_vcf_by_pop" name="Split VCF by pop" version="0.1.0">
    <description>
        from an individuals/population table.
    </description>

    <requirements>
        <requirement type="package" version="1.22">bcftools</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        mkdir -p vcf_split_directory &&

        bash '$__tool_directory__/split_vcf_by_pop.sh' 
            '${vcf_input}'
            '${vcf_input.element_identifier}'
            '$indpop'
        
    ]]></command>

    <inputs>
        <param name="vcf_input" type="data" format="vcf" label="Upload your VCF file"
            help="File containing SNP data in VCF format. You can upload a simple file, multiple files or a dataset collection. If multiple files are added, individuals and their populations must be listed in the same file."/>

        <param name="indpop" type="data" format="tabular" label="Upload your population file" 
            help="File containing individuals in the first column and their population code in the second column, separated by a tabulation character."/>
    </inputs>

    <outputs>
        <collection name="vcf_split" format="vcf" type="list" label="${tool.name}">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.vcf$" directory="vcf_split_directory" format="vcf"/>
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="vcf_input" value="test_vcf.vcf"/>
            <param name="indpop" value="test_pop.txt"/>
            <output_collection name="vcf_split" type="list" count="10"/>
        </test>
    </tests>
<help><![CDATA[
Usage
=====

As input, the user provides one or more VCF file (Danecek *et al.* 2011) and a population file (indpop) defining population assigments for each individual. If there are multiple VCF files, then the indpop file contain all individuals present in all VCF files as well as their population.

For each population name identified in the indpop file, the tool extracts the corresponding list of individuals and generates a VCF file containing only those samples.

Example : if an indpop file defines three groups (pop1, pop2 and pop3), the tool repeats the extraction process three times to produce three separate VCF files, one for each population.

Example of an indpop file :  

::

    ind1    pop1
    ind2    pop2
    ind3    pop2
    ind4    pop1
    ind5    pop3

The indpop file must be a tab-separated file where individual names match those included in the VCF header line exactly.

See also examples of VCF formats in :  https://samtools.github.io/hts-specs/VCFv4.5.pdf

]]></help>

    <citations>
        <citation type="bibtex">
        @article{10.1093/gigascience/giab008,
    author = {Danecek, Petr and Bonfield, James K and Liddle, Jennifer and Marshall, John and Ohan, Valeriu and Pollard, Martin O and Whitwham, Andrew and Keane, Thomas and McCarthy, Shane A and Davies, Robert M and Li, Heng},
    title = "{Twelve years of SAMtools and BCFtools}",
    journal = {GigaScience},
    volume = {10},
    number = {2},
    year = {2021},
    abstract = "{SAMtools and BCFtools are widely used programs for processing and analysing high-throughput sequencing data. They include tools for file format conversion and manipulation, sorting, querying, statistics, variant calling, and effect analysis amongst other methods.The first version appeared online 12 years ago and has been maintained and further developed ever since, with many new features and improvements added over the years. The SAMtools and BCFtools packages represent a unique collection of tools that have been used in numerous other software projects and countless genomic pipelines.Both SAMtools and BCFtools are freely available on GitHub under the permissive MIT licence, free for both non-commercial and commercial use. Both packages have been installed \\&gt;1 million times via Bioconda. The source code and documentation are available from https://www.htslib.org.}",
    issn = {2047-217X},
    doi = {10.1093/gigascience/giab008},
    url = {https://doi.org/10.1093/gigascience/giab008},
    note = {giab008},
    eprint = {https://academic.oup.com/gigascience/article-pdf/10/2/giab008/36332246/giab008.pdf},
}
        </citation>
        
        <citation type="bibtex">
            @article{Danecek2011,
  author          = {Danecek, Petr and Auton, Adam and Abecasis, Goncalo and Albers, Cornelis A. and Banks, Erica and DePristo, Mark A. and Handsaker, Robert E. and Lunter, Gerton and Marth, Gabor T. and Sherry, Stephen T. and McVean, Gil and Durbin, Richard and {1000 Genomes Project Analysis Group}},
  title           = {The variant call format and {VCF}tools},
  journal         = {Bioinformatics},
  volume          = {27},
  number          = {15},
  pages           = {2156-2158},
  year            = {2011},
  doi             = {10.1093/bioinformatics/btr330},
  URL             = {https://doi.org/10.1093/bioinformatics/btr330},
  eprint          = {https://academic.oup.com/bioinformatics/article-pdf/27/15/2156/600788/btr330.pdf},
}
        </citation>
    <citation type="bibtex">
        @manual{VCFv45,
  title        = {The Variant Call Format (VCF) Specification, Version 4.5},
  author       = {{HTS-specs team}},
  organization = {Global Alliance for Genomics and Health},
  year         = {2024},
  url          = {https://samtools.github.io/hts-specs/VCFv4.5.pdf},
  note         = {Accessed: 2025-02-11}
}
    </citation>
    </citations>
</tool>